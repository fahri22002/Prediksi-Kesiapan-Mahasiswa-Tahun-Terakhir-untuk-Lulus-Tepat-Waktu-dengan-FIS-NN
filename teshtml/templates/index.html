<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediksi Kelulusan Mahasiswa</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#f4ae00',
                        background: '#FAFAFA'
                    }
                }
            }
        }
    </script>
</head>

<body class="min-h-screen bg-[#FAFAFA]">
    <div class="container mx-auto px-3 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8 max-w-sm sm:max-w-lg lg:max-w-2xl xl:max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-6 sm:mb-8">
            <div class="w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4 rounded-full flex items-center justify-center shadow-lg bg-[#f4ae00]">
                <svg class="w-6 h-6 sm:w-8 sm:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                    </path>
                </svg>
            </div>
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-1 sm:mb-2">Klasifikasi Kesiapan Lulus Mahasiswa</h2>
            <p class="text-gray-600 text-xs sm:text-sm px-2">Masukkan data mahasiswa taun ke-4 untuk mendapatkan prediksi kategori</p>
        </div>

        <!-- Form Card -->
        <div class="bg-white rounded-xl sm:rounded-2xl shadow-lg sm:shadow-xl p-4 sm:p-6 mb-4 sm:mb-6">
            <form method="post" class="space-y-4 sm:space-y-5">
                <!-- IPK Input -->
                <div class="space-y-1 sm:space-y-2">
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700">
                        IPK
                    </label>
                    <div class="relative">
                        <input type="number" name="ipk" step="0.01" required placeholder="Contoh: 3.75"
                            class="w-full px-3 py-2 sm:px-4 sm:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:border-[#f4ae00] focus:ring-[#f4ae00] transition-all duration-200 text-gray-800 placeholder-gray-400 text-sm sm:text-base">
                        <div class="absolute inset-y-0 right-0 pr-2 sm:pr-3 flex items-center pointer-events-none">
                            <span class="text-gray-400 text-xs sm:text-sm">/ 4.0</span>
                        </div>
                    </div>
                </div>

                <!-- Progress Input -->
                <div class="space-y-1 sm:space-y-2">
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700">
                        Progress Skripsi (%)
                    </label>
                    <input type="number" name="progress" required placeholder="Contoh: 75" min="0" max="100"
                        class="w-full px-3 py-2 sm:px-4 sm:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:border-[#f4ae00] focus:ring-[#f4ae00] transition-all duration-200 text-gray-800 placeholder-gray-400 text-sm sm:text-base">
                </div>

                <!-- Kehadiran Input -->
                <div class="space-y-1 sm:space-y-2">
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700">
                        Rata-Rata Kehadiran (%)
                    </label>
                    <input type="number" name="kehadiran" required placeholder="Contoh: 85" min="0" max="100"
                        class="w-full px-3 py-2 sm:px-4 sm:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:border-[#f4ae00] focus:ring-[#f4ae00] transition-all duration-200 text-gray-800 placeholder-gray-400 text-sm sm:text-base">
                </div>

                <!-- Organisasi Input -->
                <div class="space-y-1 sm:space-y-2">
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700">
                        Jam Organisasi Perminggu
                    </label>
                    <input type="number" name="organisasi" required placeholder="Jam kegiatan organisasi yang diikuti"
                        min="0"
                        class="w-full px-3 py-2 sm:px-4 sm:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:border-[#f4ae00] focus:ring-[#f4ae00] transition-all duration-200 text-gray-800 placeholder-gray-400 text-sm sm:text-base">
                </div>

                <!-- Magang Input -->
                <div class="space-y-1 sm:space-y-2">
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700">
                        Magang
                    </label>
                    <div class="flex space-x-3 sm:space-x-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="magang" value="1" required
                                class="form-radio text-[#f4ae00] focus:ring-[#f4ae00] w-4 h-4">
                            <span class="ml-1 sm:ml-2 text-gray-800 text-sm sm:text-base">Ya</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="magang" value="0"
                                class="form-radio text-[#f4ae00] focus:ring-[#f4ae00] w-4 h-4">
                            <span class="ml-1 sm:ml-2 text-gray-800 text-sm sm:text-base">Tidak</span>
                        </label>
                    </div>
                </div>

                <!-- SKS Input -->
                <div class="space-y-1 sm:space-y-2">
                    <label class="block text-xs sm:text-sm font-semibold text-gray-700">
                        SKS
                    </label>
                    <input type="number" name="sks" required placeholder="Total SKS yang telah diambil" min="0"
                        class="w-full px-3 py-2 sm:px-4 sm:py-3 border-2 border-gray-200 rounded-lg sm:rounded-xl focus:outline-none focus:ring-2 focus:border-[#f4ae00] focus:ring-[#f4ae00] transition-all duration-200 text-gray-800 placeholder-gray-400 text-sm sm:text-base">
                </div>

                <!-- Submit Button -->
                <button type="submit"
                    class="w-full py-3 sm:py-4 px-4 sm:px-6 text-white font-bold rounded-lg sm:rounded-xl shadow-lg transform transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-4 bg-[#f4ae00] focus:ring-[#f4ae00] focus:ring-opacity-50 mt-4 sm:mt-6 text-sm sm:text-base">
                    <div class="flex items-center justify-center space-x-2">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        <span>Prediksi Sekarang</span>
                    </div>
                </button>
            </form>
        </div>

        <!-- Result Card -->
        {% if result %}
        <div class="bg-white rounded-xl sm:rounded-2xl shadow-lg sm:shadow-xl p-4 sm:p-6 border-l-4 mb-4 sm:mb-6" style="border-left-color: #f4ae00;">
            <div class="flex items-start space-x-2 sm:space-x-3">
                <div class="flex-shrink-0">
                    <div class="w-6 h-6 sm:w-8 sm:h-8 rounded-full flex items-center justify-center bg-[#f4ae00]">
                        <svg class="w-3 h-3 sm:w-4 sm:h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                    </div>
                </div>
                <div class="flex-1">
                    <h3 class="text-base sm:text-lg font-bold text-gray-800 mb-1 sm:mb-2">Hasil Prediksi</h3>
                    <div class="text-gray-700 font-medium text-sm sm:text-base">{{ result|safe }}</div>
                </div>
            </div>
        </div>
        {% endif %}

        {% if chart_data %}
        <!-- Grafik Section -->
        <div class="space-y-4 sm:space-y-6">
            <h2 class="text-lg sm:text-xl font-bold text-gray-800 text-center mb-4 sm:mb-6">Visualisasi Data Input</h2>
            
            <!-- Academic Performance Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                <!-- IPK Chart -->
                <div class="bg-white rounded-xl sm:rounded-2xl shadow-lg sm:shadow-xl p-4 sm:p-6">
                    <h3 class="text-sm sm:text-base font-bold text-gray-800 mb-3 text-center">IPK</h3>
                    <div class="w-full" style="position: relative; height: 200px;">
                        <canvas id="ipkChart"></canvas>
                    </div>
                    <p class="text-xs sm:text-sm text-gray-600 text-center mt-2">Skala: 0.0 - 4.0</p>
                </div>

                <!-- Progress Chart -->
                <div class="bg-white rounded-xl sm:rounded-2xl shadow-lg sm:shadow-xl p-4 sm:p-6">
                    <h3 class="text-sm sm:text-base font-bold text-gray-800 mb-3 text-center">Progress Skripsi</h3>
                    <div class="w-full" style="position: relative; height: 200px;">
                        <canvas id="progressChart"></canvas>
                    </div>
                    <p class="text-xs sm:text-sm text-gray-600 text-center mt-2">Persentase: 0% - 100%</p>
                </div>
            </div>

            <!-- Attendance and Activities Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                <!-- Kehadiran Chart -->
                <div class="bg-white rounded-xl sm:rounded-2xl shadow-lg sm:shadow-xl p-4 sm:p-6">
                    <h3 class="text-sm sm:text-base font-bold text-gray-800 mb-3 text-center">Kehadiran</h3>
                    <div class="w-full" style="position: relative; height: 200px;">
                        <canvas id="kehadiranChart"></canvas>
                    </div>
                    <p class="text-xs sm:text-sm text-gray-600 text-center mt-2">Persentase: 0% - 100%</p>
                </div>

                <!-- Organisasi Chart -->
                <div class="bg-white rounded-xl sm:rounded-2xl shadow-lg sm:shadow-xl p-4 sm:p-6">
                    <h3 class="text-sm sm:text-base font-bold text-gray-800 mb-3 text-center">Jam Organisasi</h3>
                    <div class="w-full" style="position: relative; height: 200px;">
                        <canvas id="organisasiChart"></canvas>
                    </div>
                    <p class="text-xs sm:text-sm text-gray-600 text-center mt-2">Jam per minggu</p>
                </div>
            </div>

            <!-- Other Metrics Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                <!-- Magang Chart -->
                <div class="bg-white rounded-xl sm:rounded-2xl shadow-lg sm:shadow-xl p-4 sm:p-6">
                    <h3 class="text-sm sm:text-base font-bold text-gray-800 mb-3 text-center">Status Magang</h3>
                    <div class="w-full" style="position: relative; height: 200px;">
                        <canvas id="magangChart"></canvas>
                    </div>
                    <p class="text-xs sm:text-sm text-gray-600 text-center mt-2">Ya / Tidak</p>
                </div>

                <!-- SKS Chart -->
                <div class="bg-white rounded-xl sm:rounded-2xl shadow-lg sm:shadow-xl p-4 sm:p-6">
                    <h3 class="text-sm sm:text-base font-bold text-gray-800 mb-3 text-center">Total SKS</h3>
                    <div class="w-full" style="position: relative; height: 200px;">
                        <canvas id="sksChart"></canvas>
                    </div>
                    <p class="text-xs sm:text-sm text-gray-600 text-center mt-2">Total SKS yang diambil</p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <style>
        input:focus {
            border-color: #f4ae00 !important;
            box-shadow: 0 0 0 3px rgba(244, 174, 0, 0.1) !important;
        }

        button:hover {
            background-color: #e09900 !important;
        }

        button:active {
            transform: scale(0.98) !important;
        }

        /* Custom responsive chart container */
        @media (max-width: 640px) {
            #barChart {
                max-height: 250px;
            }
        }

        @media (min-width: 641px) and (max-width: 1024px) {
            #barChart {
                max-height: 300px;
            }
        }

        @media (min-width: 1025px) {
            #barChart {
                max-height: 350px;
            }
        }
    </style>

    {% if chart_data %}
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const inputData = JSON.parse('{{ chart_data | tojson | safe }}');
        const [ipk, progress, kehadiran, organisasi, magang, sks] = inputData;

        // Common chart options
        const baseOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                x: {
                    display: false
                },
                y: {
                    beginAtZero: true,
                    ticks: {
                        font: {
                            size: window.innerWidth < 640 ? 10 : 12
                        }
                    }
                }
            }
        };

        // IPK Chart (Gauge-like)
        const ipkCtx = document.getElementById('ipkChart').getContext('2d');
        new Chart(ipkCtx, {
            type: 'doughnut',
            data: {
                labels: ['IPK', 'Sisa'],
                datasets: [{
                    data: [ipk, 4.0 - ipk],
                    backgroundColor: ['#f4ae00', '#e5e7eb'],
                    borderWidth: 0,
                    cutout: '70%'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            },
            plugins: [{
                beforeDraw: function(chart) {
                    const width = chart.width;
                    const height = chart.height;
                    const ctx = chart.ctx;
                    
                    ctx.restore();
                    const fontSize = (height / 114).toFixed(2);
                    ctx.font = fontSize + "em sans-serif";
                    ctx.textBaseline = "middle";
                    ctx.fillStyle = "#374151";
                    
                    const text = ipk.toFixed(2);
                    const textX = Math.round((width - ctx.measureText(text).width) / 2);
                    const textY = height / 2;
                    
                    ctx.fillText(text, textX, textY);
                    ctx.save();
                }
            }]
        });

        // Progress Chart (Bar)
        const progressCtx = document.getElementById('progressChart').getContext('2d');
        new Chart(progressCtx, {
            type: 'bar',
            data: {
                labels: ['Progress'],
                datasets: [{
                    data: [progress],
                    backgroundColor: ['#f4ae00'],
                    borderRadius: 8,
                    borderSkipped: false
                }]
            },
            options: {
                ...baseOptions,
                scales: {
                    ...baseOptions.scales,
                    y: {
                        ...baseOptions.scales.y,
                        max: 100
                    }
                }
            }
        });

        // Kehadiran Chart (Bar)
        const kehadiranCtx = document.getElementById('kehadiranChart').getContext('2d');
        new Chart(kehadiranCtx, {
            type: 'bar',
            data: {
                labels: ['Kehadiran'],
                datasets: [{
                    data: [kehadiran],
                    backgroundColor: ['#10b981'],
                    borderRadius: 8,
                    borderSkipped: false
                }]
            },
            options: {
                ...baseOptions,
                scales: {
                    ...baseOptions.scales,
                    y: {
                        ...baseOptions.scales.y,
                        max: 100
                    }
                }
            }
        });

        // Organisasi Chart (Bar)
        const organisasiCtx = document.getElementById('organisasiChart').getContext('2d');
        new Chart(organisasiCtx, {
            type: 'bar',
            data: {
                labels: ['Organisasi'],
                datasets: [{
                    data: [organisasi],
                    backgroundColor: ['#8b5cf6'],
                    borderRadius: 8,
                    borderSkipped: false
                }]
            },
            options: {
                ...baseOptions,
                scales: {
                    ...baseOptions.scales,
                    y: {
                        ...baseOptions.scales.y,
                        suggestedMax: Math.max(organisasi + 5, 20)
                    }
                }
            }
        });

        // Magang Chart (Pie)
        const magangCtx = document.getElementById('magangChart').getContext('2d');
        new Chart(magangCtx, {
            type: 'pie',
            data: {
                labels: magang ? ['Sudah Magang'] : ['Belum Magang'],
                datasets: [{
                    data: [1],
                    backgroundColor: [magang ? '#06d6a0' : '#ef476f'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            font: {
                                size: window.innerWidth < 640 ? 10 : 12
                            }
                        }
                    }
                }
            }
        });

        // SKS Chart (Bar)
        const sksCtx = document.getElementById('sksChart').getContext('2d');
        new Chart(sksCtx, {
            type: 'bar',
            data: {
                labels: ['SKS'],
                datasets: [{
                    data: [sks],
                    backgroundColor: ['#f59e0b'],
                    borderRadius: 8,
                    borderSkipped: false
                }]
            },
            options: {
                ...baseOptions,
                scales: {
                    ...baseOptions.scales,
                    y: {
                        ...baseOptions.scales.y,
                        suggestedMax: Math.max(sks + 20, 150)
                    }
                }
            }
        });
    </script>
    {% endif %}

</body>

</html>